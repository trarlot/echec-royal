'use client';

import { useEffect, useRef } from 'react';
import { gsap } from 'gsap';
import { ScrollTrigger } from 'gsap/ScrollTrigger';
import Image from 'next/image';
import { useTheme } from './ThemeProvider';

if (typeof window !== 'undefined') {
    gsap.registerPlugin(ScrollTrigger);
}

const Footer = () => {
    const containerRef = useRef(null);
    const titleRef = useRef(null);
    const kingRef = useRef(null);
    const rookRef = useRef(null);
    const boardRef = useRef(null);
    const { theme } = useTheme();

    useEffect(() => {
        const container = containerRef.current;
        const title = titleRef.current;

        if (!container) return;

        gsap.to(kingRef.current, {
            rotate: -90,
            translateX: '-50%',
            translateY: '-19%',
            transformOrigin: 'center bottom',
            scrollTrigger: {
                trigger: container,
                pin: kingRef.current,
                start: 'top top',
                end: 'bottom 99%',
                scrub: true,
            },
        });

        return () => {
            ScrollTrigger.getAll().forEach((trigger) => trigger.kill());
        };
    }, []);

    // SVG King avec couleurs dynamiques
    const KingSvg = () => (
        <svg
            width="444"
            height="999"
            viewBox="0 0 444 999"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="object-cover w-[40vh] z-10 h-auto">
            <g clipPath="url(#clip0_10748_2828)">
                <mask
                    id="mask0_10748_2828"
                    style={{ maskType: 'luminance' }}
                    maskUnits="userSpaceOnUse"
                    x="-411"
                    y="-138"
                    width="1319"
                    height="1319">
                    <path
                        d="M907.039 784.082L511.082 -137.453L-410.453 258.504L-14.4964 1180.04L907.039 784.082Z"
                        fill="white"
                    />
                </mask>
                <g mask="url(#mask0_10748_2828)">
                    <path
                        d="M339.387 629.725L102.544 629.858L99.4806 663.671L342.473 663.545L339.387 629.725Z"
                        fill={theme === 'dark' ? 'white' : 'black'}
                    />
                    <path
                        d="M440.934 950.901C440.935 943.962 439.543 937.254 436.813 930.901C428.798 912.245 410.494 900.181 390.18 900.186L380.781 900.195C386.593 890.209 390.171 878.753 390.176 866.385C390.174 857.13 388.337 848.185 384.712 839.75C378.719 825.801 368.337 814.786 355.67 807.661L345.575 697.357L96.4395 697.491L86.4546 807.958C81.2075 810.948 76.1847 814.376 71.8171 818.773C59.0513 831.546 52.0163 848.535 52.046 866.593C52.0486 875.848 53.8853 884.793 57.5098 893.227C58.5845 895.728 59.8876 898.076 61.2302 900.388L52.0669 900.387C38.5092 900.397 25.7673 905.688 16.1919 915.268C6.62388 924.863 1.35055 937.599 1.36057 951.157C1.37561 958.088 2.75228 964.806 5.47481 971.141C13.4978 989.811 31.8164 1001.87 52.1079 1001.85L390.251 1001.68C418.222 1001.64 440.952 978.865 440.934 950.901Z"
                        fill={theme === 'dark' ? 'white' : 'black'}
                    />
                    <path
                        d="M336.286 595.91L323.923 460.671L330.769 460.674C363.405 460.654 389.936 434.092 389.902 401.462C389.892 393.388 388.286 385.54 385.109 378.147C377.414 360.236 361.553 347.693 342.991 343.762L365.701 241.371C367.635 232.683 366.802 223.803 363.318 215.695C356.643 200.162 341.438 190.17 324.586 190.179L288.345 190.202L288.336 161.573L298.933 161.565C309.846 161.568 320.427 157.243 327.945 149.688C335.109 142.506 339.032 133.092 339.029 123.193L339.014 87.9979C338.98 67.2746 320.474 49.6843 298.881 49.6697L288.27 49.6838L288.256 41.1699C288.19 20.4597 269.723 2.83467 248.122 2.84149L193.098 2.87484C182.647 2.8756 172.731 6.69441 165.216 13.6588C157.326 20.9498 152.996 30.7418 152.994 41.2312L153.009 49.7448L142.397 49.7591C120.282 49.7663 102.298 66.9698 102.309 88.1085L102.339 123.298C102.345 128.319 103.348 133.225 105.344 137.869C111.544 152.3 126.098 161.633 142.45 161.617L153.062 161.603L153.077 190.247L116.852 190.263C104.023 190.255 92.0487 196.008 84.0397 206.018C75.999 216.042 73.0013 228.978 75.8055 241.501L98.5881 343.776C87.4927 346.133 77.2944 351.564 69.0867 359.783C57.9039 370.973 51.7639 385.848 51.7739 401.632C51.7839 409.706 53.3894 417.555 56.5666 424.949C65.9171 446.712 87.2777 460.793 110.97 460.771L117.832 460.767L105.616 596.022L336.286 595.91ZM186.874 127.79L142.446 127.816C139.264 127.821 137.092 126.104 136.418 124.535L136.126 88.0973C136.128 85.9619 138.706 83.5658 142.409 83.5764L186.837 83.55L186.804 41.2042C186.806 40.0077 187.542 39.0656 188.181 38.4968C189.405 37.3635 191.208 36.718 193.117 36.7073L248.157 36.6673C251.08 36.6623 253.155 38.1078 254.196 40.5311C254.289 40.7485 254.361 40.9572 254.438 41.1813L254.465 83.5115L298.893 83.4861C302.074 83.4813 304.241 85.3106 305.198 88.0091L305.219 123.221C305.226 124.137 304.821 124.992 304.018 125.779C302.788 127.025 300.921 127.736 298.93 127.726L254.495 127.736L254.522 190.197L220.711 190.224L186.901 190.252L186.874 127.79ZM85.5755 401.627C85.5731 394.857 88.2139 388.497 92.998 383.699C97.7661 378.908 104.122 376.269 110.871 376.259L330.711 376.125C340.874 376.139 350.015 382.166 354.019 391.487C355.367 394.624 356.059 397.989 356.069 401.481C356.077 415.463 344.702 426.846 330.72 426.854L320.806 426.864L220.816 426.914L110.912 426.974C97.3381 426.992 85.5945 415.421 85.5755 401.627Z"
                        fill={theme === 'dark' ? 'white' : 'black'}
                    />
                </g>
            </g>
            <defs>
                <clipPath id="clip0_10748_2828">
                    <rect width="444" height="999" fill="white" />
                </clipPath>
            </defs>
        </svg>
    );

    return (
        <>
            <footer
                ref={containerRef}
                className="flex flex-col justify-center items-center relative">
                <div className="flex bg-theme-secondary w-full justify-end relative">
                    <div ref={kingRef}>
                        <KingSvg />
                    </div>
                </div>

                <div className="text-center z-20 relative bg-theme-secondary w-full">
                    <h1
                        ref={titleRef}
                        className="text-[12rem] md:text-[16rem] font-playfair font-bold text-theme-primary leading-none tracking-wider">
                        ECHEC
                    </h1>
                </div>

                <div className="w-full bg-theme-secondary text-theme-primary py-8 px-8 z-20 relative">
                    <div className="flex justify-between items-center">
                        <div className="flex gap-4">
                            <svg
                                width="30"
                                height="30"
                                viewBox="0 0 37 36"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M33.1911 9.8205C33.1771 9.17704 33.1255 8.53494 33.0366 7.8975C32.929 7.3306 32.7459 6.78069 32.4921 6.2625C31.9371 5.16627 31.047 4.27561 29.9511 3.72C29.4361 3.46759 28.8898 3.28498 28.3266 3.177C27.6842 3.08645 27.0371 3.03386 26.3886 3.0195C26.1141 3.009 25.7586 3.0045 25.5936 3.0045L10.8216 3C10.6566 3 10.3011 3.0045 10.0266 3.015C9.38309 3.02895 8.74099 3.08054 8.10355 3.1695C7.53665 3.27705 6.98675 3.46018 6.46855 3.714C5.37232 4.26896 4.48166 5.15909 3.92605 6.255C3.67364 6.76995 3.49103 7.31627 3.38305 7.8795C3.292 8.52181 3.23891 9.16894 3.22405 9.8175C3.21505 10.092 3.20905 10.4475 3.20905 10.6125L3.20605 25.3845C3.20605 25.5495 3.21055 25.905 3.22105 26.1795C3.23501 26.823 3.28659 27.4651 3.37555 28.1025C3.4831 28.6694 3.66624 29.2193 3.92005 29.7375C4.47501 30.8337 5.36515 31.7244 6.46105 32.28C6.97601 32.5324 7.52232 32.715 8.08555 32.823C8.7279 32.9135 9.37502 32.9661 10.0236 32.9805C10.2981 32.991 10.6536 32.9955 10.8186 32.9955L25.5906 32.9985C25.7556 32.9985 26.1111 32.994 26.3856 32.9835C27.029 32.9695 27.6711 32.918 28.3086 32.829C28.8755 32.7214 29.4254 32.5383 29.9436 32.2845C31.0403 31.7298 31.9316 30.8396 32.4876 29.7435C32.74 29.2285 32.9226 28.6822 33.0306 28.119C33.1216 27.4767 33.1747 26.8296 33.1896 26.181C33.1986 25.9065 33.2046 25.551 33.2046 25.386L33.2061 10.6155C33.2061 10.4505 33.2016 10.095 33.1911 9.8205ZM18.5316 28.4355H18.5271C16.7413 28.4368 14.984 27.9891 13.4166 27.1335L7.74655 28.62L9.26455 23.0805C8.08923 21.041 7.61961 18.6707 7.9285 16.3371C8.23739 14.0035 9.30754 11.837 10.973 10.1735C12.6385 8.51 14.8063 7.44243 17.1402 7.13632C19.4742 6.8302 21.8439 7.30264 23.882 8.48039C25.9202 9.65814 27.5128 11.4754 28.413 13.6504C29.3133 15.8254 29.4708 18.2366 28.8611 20.5103C28.2515 22.7839 26.9088 24.7929 25.0412 26.2258C23.1736 27.6587 20.8855 28.4354 18.5316 28.4355Z"
                                    fill="var(--primary-color)"
                                />
                                <path
                                    d="M18.5362 8.85111C16.9478 8.85064 15.3883 9.27572 14.0199 10.0821C12.6514 10.8886 11.524 12.0469 10.7549 13.4366C9.98576 14.8263 9.60299 16.3967 9.64639 17.9845C9.68979 19.5723 10.1578 21.1195 11.0017 22.4651L11.2132 22.8011L10.3147 26.0801L13.6792 25.1981L14.0032 25.3901C15.3723 26.2025 16.9352 26.6305 18.5272 26.6291H18.5317C20.8894 26.6295 23.1507 25.6933 24.8181 24.0264C26.4855 22.3596 27.4225 20.0986 27.4229 17.7409C27.4233 15.3832 26.4871 13.1219 24.8202 11.4544C23.1534 9.78698 20.8924 8.85001 18.5347 8.84961L18.5362 8.85111ZM23.7622 21.5561C23.5658 21.8811 23.3042 22.1617 22.9939 22.3804C22.6835 22.5991 22.3312 22.751 21.9592 22.8266C21.3976 22.9231 20.8213 22.8871 20.2762 22.7216C19.7589 22.5612 19.2506 22.373 18.7537 22.1576C16.9083 21.2315 15.3353 19.8415 14.1892 18.1241C13.5637 17.3292 13.1841 16.3688 13.0972 15.3611C13.0902 14.9452 13.1699 14.5324 13.331 14.149C13.4921 13.7655 13.7313 13.4197 14.0332 13.1336C14.1227 13.0321 14.2322 12.95 14.3547 12.8925C14.4773 12.835 14.6103 12.8032 14.7457 12.7991C14.9227 12.7991 15.1012 12.7991 15.2572 12.8081C15.4222 12.8156 15.6412 12.7451 15.8572 13.2671C16.0822 13.8011 16.6162 15.1166 16.6822 15.2501C16.7243 15.3202 16.7484 15.3996 16.7523 15.4813C16.7562 15.5629 16.7399 15.6443 16.7047 15.7181C16.6377 15.8787 16.5477 16.0288 16.4377 16.1636C16.3027 16.3196 16.1572 16.5116 16.0372 16.6316C15.9022 16.7651 15.7642 16.9091 15.9187 17.1761C16.3206 17.8628 16.8214 18.4865 17.4052 19.0271C18.0398 19.5898 18.767 20.0384 19.5547 20.3531C19.8217 20.4881 19.9777 20.4641 20.1337 20.2856C20.2897 20.1071 20.8012 19.5056 20.9797 19.2386C21.1582 18.9716 21.3352 19.0166 21.5797 19.1051C21.8242 19.1936 23.1397 19.8401 23.4067 19.9751C23.6737 20.1101 23.8522 20.1746 23.9182 20.2856C23.9903 20.7153 23.9361 21.1566 23.7622 21.5561Z"
                                    fill="var(--primary-color)"
                                />
                            </svg>

                            <svg
                                width="30"
                                height="30"
                                viewBox="0 0 37 36"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M33.2061 18C33.2061 9.72 26.4861 3 18.2061 3C9.92605 3 3.20605 9.72 3.20605 18C3.20605 25.26 8.36605 31.305 15.2061 32.7V22.5H12.2061V18H15.2061V14.25C15.2061 11.355 17.5611 9 20.4561 9H24.2061V13.5H21.2061C20.3811 13.5 19.7061 14.175 19.7061 15V18H24.2061V22.5H19.7061V32.925C27.2811 32.175 33.2061 25.785 33.2061 18Z"
                                    fill="var(--primary-color)"
                                />
                            </svg>

                            <svg
                                width="30"
                                height="30"
                                viewBox="0 0 37 36"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M19.7479 3C21.4354 3.0045 22.2919 3.0135 23.0314 3.0345L23.3224 3.045C23.6584 3.057 23.9899 3.072 24.3904 3.09C25.9864 3.165 27.0754 3.417 28.0309 3.7875C29.0209 4.1685 29.8549 4.6845 30.6889 5.517C31.452 6.2666 32.0422 7.17371 32.4184 8.175C32.7889 9.1305 33.0409 10.2195 33.1159 11.817C33.1339 12.216 33.1489 12.5475 33.1609 12.885L33.1699 13.176C33.1924 13.914 33.2014 14.7705 33.2044 16.458L33.2059 17.577V19.542C33.2096 20.6361 33.1981 21.7302 33.1714 22.824L33.1624 23.115C33.1504 23.4525 33.1354 23.784 33.1174 24.183C33.0424 25.7805 32.7874 26.868 32.4184 27.825C32.0422 28.8263 31.452 29.7334 30.6889 30.483C29.9393 31.246 29.0322 31.8363 28.0309 32.2125C27.0754 32.583 25.9864 32.835 24.3904 32.91L23.3224 32.955L23.0314 32.964C22.2919 32.985 21.4354 32.9955 19.7479 32.9985L18.6289 33H16.6654C15.5708 33.0039 14.4762 32.9924 13.3819 32.9655L13.0909 32.9565C12.7348 32.943 12.3788 32.9275 12.0229 32.91C10.4269 32.835 9.33793 32.583 8.38093 32.2125C7.38018 31.8361 6.4736 31.2459 5.72443 30.483C4.96085 29.7336 4.37009 28.8264 3.99343 27.825C3.62293 26.8695 3.37093 25.7805 3.29593 24.183L3.25093 23.115L3.24343 22.824C3.21578 21.7302 3.20328 20.6361 3.20593 19.542V16.458C3.20178 15.3639 3.21278 14.2698 3.23893 13.176L3.24943 12.885C3.26143 12.5475 3.27643 12.216 3.29443 11.817C3.36943 10.2195 3.62143 9.132 3.99193 8.175C4.36947 7.1733 4.96127 6.26615 5.72593 5.517C6.47466 4.75432 7.38071 4.16411 8.38093 3.7875C9.33793 3.417 10.4254 3.165 12.0229 3.09C12.4219 3.072 12.7549 3.057 13.0909 3.045L13.3819 3.036C14.4757 3.00935 15.5698 2.99785 16.6639 3.0015L19.7479 3ZM18.2059 10.5C16.2168 10.5 14.3092 11.2902 12.9026 12.6967C11.4961 14.1032 10.7059 16.0109 10.7059 18C10.7059 19.9891 11.4961 21.8968 12.9026 23.3033C14.3092 24.7098 16.2168 25.5 18.2059 25.5C20.1951 25.5 22.1027 24.7098 23.5092 23.3033C24.9158 21.8968 25.7059 19.9891 25.7059 18C25.7059 16.0109 24.9158 14.1032 23.5092 12.6967C22.1027 11.2902 20.1951 10.5 18.2059 10.5ZM18.2059 13.5C18.7969 13.4999 19.3821 13.6162 19.9281 13.8423C20.4741 14.0683 20.9702 14.3997 21.3881 14.8175C21.8061 15.2353 22.1376 15.7313 22.3639 16.2772C22.5901 16.8232 22.7066 17.4083 22.7067 17.9993C22.7068 18.5902 22.5905 19.1754 22.3644 19.7214C22.1384 20.2674 21.807 20.7635 21.3892 21.1814C20.9714 21.5994 20.4754 21.9309 19.9294 22.1572C19.3835 22.3834 18.7984 22.4999 18.2074 22.5C17.014 22.5 15.8694 22.0259 15.0255 21.182C14.1815 20.3381 13.7074 19.1935 13.7074 18C13.7074 16.8065 14.1815 15.6619 15.0255 14.818C15.8694 13.9741 17.014 13.5 18.2074 13.5M26.0824 8.25C25.5851 8.25 25.1082 8.44754 24.7566 8.79917C24.405 9.15081 24.2074 9.62772 24.2074 10.125C24.2074 10.6223 24.405 11.0992 24.7566 11.4508C25.1082 11.8025 25.5851 12 26.0824 12C26.5797 12 27.0566 11.8025 27.4083 11.4508C27.7599 11.0992 27.9574 10.6223 27.9574 10.125C27.9574 9.62772 27.7599 9.15081 27.4083 8.79917C27.0566 8.44754 26.5797 8.25 26.0824 8.25Z"
                                    fill="var(--primary-color)"
                                />
                            </svg>
                        </div>

                        <div className="flex space-x-8 text-sm">
                            <span>Mentions Légales</span>
                            <span>Échec Royal ©2025</span>
                            <span>All rights reserved</span>
                        </div>
                    </div>
                </div>
                <div className="bg-transparent h-[50vh]"></div>
            </footer>
            <div
                ref={boardRef}
                className="w-full h-[50vh] mx-auto grid grid-cols-8 gap-0 fixed bottom-0 -z-10">
                {[...Array(64)].map((_, index) => {
                    const row = Math.floor(index / 8);
                    const col = index % 8;
                    const isLight = (row + col) % 2 === 0;

                    return (
                        <div
                            key={index}
                            className={`${isLight ? 'bg-brown' : 'bg-beige'}`}
                        />
                    );
                })}
            </div>
        </>
    );
};

export default Footer;
